---
title: ปัญหาการรับรองความถูกต้อง
ms.author: v-smandalika
author: v-smandalika
manager: dansimp
ms.date: 01/25/2021
ms.audience: Admin
ms.topic: article
ms.service: o365-administration
ROBOTS: NOINDEX, NOFOLLOW
localization_priority: Priority
ms.collection: Adm_O365
ms.custom:
- "7748"
- "9004339"
ms.openlocfilehash: c7e6d96940f8d7052ee4b49b22c0d1d7d5bd5f9277f4a7eff709def1da2e13af
ms.sourcegitcommit: b5f7da89a650d2915dc652449623c78be6247175
ms.translationtype: MT
ms.contentlocale: th-TH
ms.lasthandoff: 08/05/2021
ms.locfileid: "54019527"
---
# <a name="authentication-issues"></a>ปัญหาการรับรองความถูกต้อง

**ค้นหาข้อมูลเกี่ยวกับรหัสข้อผิดพลาด AADSTS ที่ส่งกลับจากบริการโทเค็นความปลอดภัยของ Azure Active Directory (Azure AD) (STS) อยู่ใช่หรือไม่** ดู [รหัสข้อผิดพลาดการรับรองความถูกต้องและการอนุญาต Azure AD](https://docs.microsoft.com/azure/active-directory/develop/reference-aadsts-error-codes) เพื่อค้นหารายละเอียดข้อผิดพลาด AADSTS การแก้ไข และการแก้ไขปัญหาชั่วคราวที่แนะนะ

ข้อผิดพลาดในการตรวจสอบอาจเป็นผลจากปัญหาต่างๆ มากมาย โดยส่วนใหญ่จะสร้างข้อผิดพลาด 401 หรือ 403 ตัวอย่างเช่น ปัญหาต่อไปนี้อาจก่อให้เกิดข้อผิดพลาดในการตรวจสอบได้ทั้งหมด:

- โฟล [ว์การรับโทเค็นการเข้าถึงที่ไม่ถูกต้อง](https://docs.microsoft.com/azure/active-directory/develop/authentication-vs-authorization) 
- กําหนดค่าขอบเขต [สิทธิ์ไม่ดี](https://docs.microsoft.com/azure/active-directory/develop/v2-permissions-and-consent) 
- ไม่มีความยินยอม[](https://docs.microsoft.com/azure/active-directory/develop/howto-convert-app-to-be-multi-tenant#understanding-user-and-admin-consent)

เมื่อต้องการแก้ไขข้อผิดพลาดทั่วไปในการอนุญาต ให้ลองขั้นตอนที่ระบุไว้ด้านล่างซึ่งใกล้เคียงกับข้อผิดพลาดที่คุณได้รับมากที่สุด อาจมีการใช้มากกว่าหนึ่งขั้นตอนกับข้อผิดพลาดที่คุณได้รับ

**ข้อผิดพลาด 401 ไม่ได้รับอนุญาต: โทเค็นของคุณถูกต้องหรือไม่**

ตรวจสอบให้แน่ใจว่าแอปของคุณแสดงโทเค็นการเข้าถึงที่ถูกต้องGraph Microsoft เป็นส่วนหนึ่งของการร้องขอ ข้อผิดพลาดนี้มักจะหมายความว่าโทเค็นการเข้าถึงอาจหายไปในส่วนหัวของการร้องขอการรับรองความถูกต้อง HTTP หรือโทเค็นไม่ถูกต้องหรือหมดอายุแล้ว เราขอแนะให้ คุณใช้ไลบรารีการรับรองความถูกต้องของ Microsoft (MSAL) เพื่อการรับโทเค็นการเข้าถึง นอกจากนี้ ข้อผิดพลาดนี้อาจเกิดขึ้นถ้าคุณพยายามใช้โทเค็นการเข้าถึงที่ได้รับมอบสิทธิ์ให้กับบัญชี Microsoft ส่วนบุคคลเพื่อเข้าถึง API ที่สนับสนุนเฉพาะบัญชีที่โรงเรียนหรือที่โรงเรียน (บัญชีขององค์กร)

**ข้อผิดพลาด 403 Forbidden: คุณได้เลือกชุดสิทธิ์ที่ถูกต้องหรือไม่**

ตรวจสอบให้แน่ใจว่าคุณได้ขอชุดสิทธิ์ที่ถูกต้องโดยยึดตาม MICROSOFT Graph API ที่แอปของคุณเรียก สิทธิ์ที่น้อยที่สุดที่ได้รับสิทธิ์ที่แนะGraphมีอยู่ในหัวข้อวิธีการอ้างอิง API ของ Microsoft Graphทั้งหมด นอกจากนี้ สิทธิ์เหล่านั้นต้องถูกมอบให้กับแอปพลิเคชันโดยผู้ใช้หรือผู้ดูแลระบบ การให้สิทธิ์ตามปกติจะเกิดขึ้นผ่านหน้าความยินยอมหรือการใช้งานใบลงทะเบียนแอปพลิเคชัน Azure Portal จาก **การตั้งค่า** Blade ของแอปพลิเคชัน **ให้คลิก สิทธิ์** ที่ต้องมี **แล้วคลิก ให้** สิทธิ์ สำหรับข้อมูลเพิ่มเติม ให้ดู:

- [สิทธิ์Graphของ Microsoft](https://docs.microsoft.com/graph/permissions-reference) 
- [การความเข้าใจสิทธิ์และความยินยอมของ Azure AD](https://docs.microsoft.com/azure/active-directory/develop/v2-permissions-and-consent)

**ข้อผิดพลาด 403 Forbidden: แอปของคุณได้รับโทเค็นเพื่อจับคู่กับสิทธิ์ที่เลือกหรือไม่**

ตรวจสอบให้แน่ใจว่าชนิดของสิทธิ์ที่ร้องขอหรือที่ได้รับตรงกับชนิดของโทเค็นการเข้าถึงที่แอปของคุณได้รับ คุณอาจร้องขอและให้สิทธิ์แอป แต่ใช้โทเค็นโฟลว์โค้ดแบบโต้ตอบที่ได้รับมอบสิทธิ์แทนโทเค็นโฟลว์ข้อมูลรับรองความถูกต้องของไคลเอ็นต์ หรือร้องขอและมอบสิทธิ์ที่ได้รับมอบสิทธิ์ แต่ใช้โทเค็นโฟลว์ข้อมูลรับรองไคลเอ็นต์แทนโทเค็นโฟลว์ของโค้ดที่ได้รับมอบสิทธิ์

For more information related to acquiring tokens, see:

- [เข้าถึงในนามของผู้ใช้และสิทธิ์ที่ได้รับมอบหมาย](https://docs.microsoft.com/graph/auth-v2-user) 
- [Azure AD v2.0 - โฟลว์รหัสการรับรองความถูกต้อง OAuth 2.0](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-auth-code-flow) 
- [รับสิทธิ์การเข้าถึงโดยไม่มีผู้ใช้ (บริการ daemon) และสิทธิ์ของแอปพลิเคชัน](https://docs.microsoft.com/graph/auth-v2-service) 
- [Azure AD v2.0 - โฟลว์ข้อมูลรับรองไคลเอ็นต์ OAuth 2.0](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-client-creds-grant-flow)

**ข้อผิดพลาด 403 Forbidden: การตั้งค่ารหัสผ่านใหม่**

ในขณะนี้ ยังไม่มีสิทธิ์ของสิทธิ์ของแอปพลิเคชัน daemon service-to-service ที่อนุญาตการตั้งค่ารหัสผ่านผู้ใช้ใหม่ API เหล่านี้ได้รับการสนับสนุนโดยใช้โค้ดที่ได้รับมอบสิทธิ์แบบโต้ตอบกับผู้ดูแลระบบที่ลงชื่อเข้าใช้เท่านั้น ดูข้อมูลเพิ่มเติมที่ สิทธิ์Graph [Microsoft](https://docs.microsoft.com/graph/permissions-reference)

**403 Forbidden: ผู้ใช้มีสิทธิ์เข้าถึงและพวกเขาได้รับสิทธิ์การใช้งานหรือไม่**

Microsoft Graph จะประเมินว่าการร้องขอได้รับอนุญาตหรือไม่ตามสิทธิ์ที่ได้รับสิทธิ์ในแอปและสิทธิ์ที่ผู้ใช้ที่ลงชื่อเข้าใช้มี โดยทั่วไปข้อผิดพลาดนี้ระบุว่าผู้ใช้ไม่มีสิทธิ์เพียงพอที่จะร้องขอ หรือผู้ใช้ไม่ได้รับสิทธิ์การใช้งานข้อมูลที่ถูกเข้าถึง เฉพาะผู้ใช้ที่มีสิทธิ์หรือสิทธิ์การใช้งานที่ต้องใช้เท่านั้นที่สามารถร้องขอได้

**403 Forbidden: คุณเลือก API ทรัพยากรที่ถูกต้องหรือไม่**

บริการ API เช่น Microsoft Graph ตรวจสอบว่า aud *claim* (ผู้ชม) ในโทเค็นการเข้าถึงที่ได้รับตรงกับค่าที่โปรแกรมคาดไว้และถ้าไม่ มีข้อผิดพลาด 403 Forbidden เกิดขึ้น ข้อผิดพลาดทั่วไปที่ส่งผลให้เกิดข้อผิดพลาดนี้พยายามใช้โทเค็นที่ซื้อมาให้กับ API ของ Azure AD Graph, Outlook API หรือ API SharePoint/OneDrive เพื่อเรียกใช้ Microsoft Graph (หรือในทางกลับกันด้วย) ตรวจสอบให้แน่ใจว่าทรัพยากร (หรือขอบเขต) แอปของคุณได้รับโทเค็นเพื่อให้ตรงกับ API ที่แอปนั้นเรียก

**400 การร้องขอที่ไม่ดีหรือ 403 ไม่ได้รับอนุญาต: ผู้ใช้ปฏิบัติตามนโยบายการเข้าถึงตามเงื่อนไข (CA) ขององค์กรของพวกเขาหรือไม่**

ขึ้นอยู่กับนโยบายการเข้าถึงตามเงื่อนไข (CA) ขององค์กร ผู้ใช้ที่เข้าถึงแหล่งข้อมูล Microsoft Graph ผ่านทางแอปของคุณอาจท้าทายในข้อมูลเพิ่มเติมที่ไม่อยู่ในโทเค็นการเข้าถึงที่แอปของคุณได้รับแต่แรก ในกรณีนี้ แอปของคุณได้รับข้อผิดพลาด **400** ที่มีข้อผิดพลาด interaction_required ระหว่างการรับโทเค็นการเข้าถึงหรือ **403** ที่มีข้อผิดพลาดinsufficient_claimsขณะโทรหา Microsoft Graph ในทั้งสองกรณี การตอบสนองข้อผิดพลาดประกอบด้วยข้อมูลเพิ่มเติมที่สามารถนําเสนอไปยังจุดสิ้นสุดที่ได้รับอนุญาตเพื่อท้าทายผู้ใช้เพื่อดูข้อมูลเพิ่มเติม (เช่น การรับรองความถูกต้องโดยใช้หลายปัจจัยหรือการลงทะเบียนอุปกรณ์)

ดูข้อมูลเพิ่มเติมเกี่ยวกับการเข้าถึงตามเงื่อนไขที่:

- [จัดการกับความท้าทายในการเข้าถึงตามเงื่อนไขโดยใช้ MSAL](https://docs.microsoft.com/azure/active-directory/develop/msal-error-handling-dotnet#conditional-access-and-claims-challenges) 
- [แนวทางสําหรับนักพัฒนาสําหรับAzure Active Directoryการเข้าถึงตามเงื่อนไข](https://docs.microsoft.com/azure/active-directory/develop/v2-conditional-access-dev-guide)

***การสิ้นสุดการสนับสนุนAzure Active Directory (ADAL) และ Azure AD Graph API (AAD Graph)***

- ตั้งแต่วันที่ 30 มิถุนายน 2020 เราจะไม่เพิ่มฟีเจอร์ใหม่ใดๆ ลงใน Azure Active Directory Authentication Library (ADAL) และ Azure AD Graph API (AAD Graph) อีกต่อไป เราจะให้การสนับสนุนด้านเทคนิคและการอัปเดตความปลอดภัยต่อไป แต่จะไม่มีการอัปเดตฟีเจอร์อีกต่อไป
- ตั้งแต่วันที่ 30 มิถุนายน 2022 เราจะสิ้นสุดการสนับสนุน ADAL และ AAD Graph และจะไม่มีการสนับสนุนทางเทคนิคหรือการอัปเดตความปลอดภัยอีกต่อไป
    - แอปที่ใช้ ADAL บนเวอร์ชัน OS ที่มีอยู่จะยังคงสามารถใช้งานต่อหลังจากนี้ แต่จะไม่รับการสนับสนุนทางเทคนิคหรือการอัปเดตความปลอดภัยใดๆ
    - แอปที่ใช้ AAD Graphหลังจากนี้อาจไม่ได้รับการตอบกลับจากจุดสิ้นสุด AAD Graphอีกต่อไป

**การโยกย้าย ADAL**

เราขอแนะนนะ [ให้อัปเดตเป็น Microsoft Authentication Library (MSAL)](https://docs.microsoft.com/azure/active-directory/develop/v2-overview)ซึ่งมีฟีเจอร์ล่าสุดและการอัปเดตความปลอดภัย ข้อแนะน้นี้อยู่ในบริบทของ Microsoft การโยกย้ายแอปพลิเคชันไปยัง MSAL ภายในวันสิ้นสุดการสนับสนุน วัตถุประสงค์ของการโยกย้ายแอป Microsoft ไปยัง MSAL คือเพื่อให้แน่ใจว่าแอปได้รับประโยชน์จากการปรับปรุงความปลอดภัยและฟีเจอร์ที่ต่อเนื่องของ MSAL

- [อ่าน ADAL FAQ](https://docs.microsoft.com/azure/active-directory/develop/msal-migration#frequently-asked-questions-faq) 
- [เรียนรู้เกี่ยวกับวิธีการโยกย้ายแอปตามแพลตฟอร์ม](https://docs.microsoft.com/azure/active-directory/develop/msal-migration#frequently-asked-questions-faq) 
- ถ้าคุณต้องการความช่วยเหลือในการเข้าใจว่าแอปใดของคุณใช้ ADAL เราขอแนะนนะให้คุณตรวจสอบโค้ดต้นฉบับของแอปของคุณทั้งหมด และถ้าสามารถเข้าใจได้ ให้ติดต่อผู้บริการซอฟต์แวร์อิสระ (ISVs) หรือผู้ให้บริการแอป ฝ่ายสนับสนุนของ Microsoft ยังสามารถแสดงรายการแอปที่ไม่ใช่ Microsoft ADAL ทั้งหมดในผู้เช่าของคุณ

**การโยกย้าย AAD Graph**

สําหรับแอปพลิเคชันที่ใช้ AAD Graph ให้ปฏิบัติตามแนวทางของเราเพื่อโยกย้าย[แอป Azure AD Graph ไปยัง Microsoft Graph](https://docs.microsoft.com/graph/migrate-azure-ad-graph-planning-checklist?view=graph-rest-1.0&preserve-view=true)

- [รายการตรวจสอบการโยกย้ายของเราให้จุดเริ่มต้น](https://docs.microsoft.com/graph/migrate-azure-ad-graph-planning-checklist) 
- พอร์ทัลการลงทะเบียนแอป Azure ของคุณจะแสดงแอปพลิเคชันที่ใช้ AAD Graph เราขอแนะนนะให้คุณตรวจสอบโค้ดต้นฉบับของแอปของคุณทั้งหมด และถ้ามี ให้ติดต่อผู้ให้บริการ ISVs หรือแอปรายใดก็ได้ ฝ่ายสนับสนุนของ Microsoft ยังสามารถให้ข้อมูลของ AAD ทั้งหมดGraphการใช้งานในผู้เช่าของคุณ

 










